<!-- packages/example-app/app/components/receipt.html -->
<div 
  atom-socket="receipt-updates"
  atom-on-event="receipt-changed"
  atom-action="POST /action/soft-refresh-receipt"
  atom-target="#receipt-container"
>
    <h3>Чек</h3>
    
    <p class="status-message" atom-if="data.receipt.statusMessage">
      {{ data.receipt.statusMessage }}
    </p>

    <!-- 
      Этот блок будет отрендерен, ТОЛЬКО ЕСЛИ массив data.receipt.items НЕ пустой
    -->
    {{#data.receipt.items}}
    <ul class="receipt-items">
        <!-- 
          Mustache автоматически перебирает массив.
          Внутри этого блока мы находимся в контексте одного товара.
        -->
        <li>
            <span>{{name}} ({{price}}р x {{quantity}})</span>
            <button 
              class="remove-btn"
              type="button"
              atom-action="POST /action/removeItem"
              atom-target="#receipt-container"
              name="id"
              value="{{id}}"
            >×</button>
        </li>
    </ul>
    {{/data.receipt.items}}

    <!-- 
      Этот блок (инвертированная секция) будет отрендерен, ТОЛЬКО ЕСЛИ массив data.receipt.items ПУСТОЙ
    -->
    {{^data.receipt.items}}
    <div class="empty-state">
      <p>Чек пуст</p>
      <span>Добавьте товары из списка слева.</span>
    </div>
    {{/data.receipt.items}}
    
    <hr>
    
    <div class="totals">
      <p><span>Позиций:</span> <span>{{data.receipt.itemCount}} шт.</span></p>
      <p><span>Сумма:</span> <span>{{data.receipt.total}} руб.</span></p>
      <p class="discount"><span>Скидка ({{data.receipt.discountPercent}}%):</span> <span>-{{data.receipt.discount}} руб.</span></p>
      <p class="final-total"><b>Итого:</b> <b>{{data.receipt.finalTotal}} руб.</b></p>
    </div>

    <form class="coupon-form" atom-action="POST /action/applyCoupon" atom-target="#receipt-container">
      <input type="text" name="coupon_code" placeholder="Промокод">
      <button type="submit" class="action-button">Применить</button>
    </form>

    <button 
      id="clear-btn"
      type="button"
      class="action-button danger"
      atom-action="POST /action/clearReceipt"
      atom-target="#receipt-container"
    >
      Очистить чек
    </button>
    
    <button 
      type="button"
      class="action-button"
      style="margin-top: 10px; background-color: #e6f7ff;"
      atom-action="GET /action/showInfo"
    >
      Показать инфо (Тест Моста)
    </button>

    <button 
      type="button"
      class="action-button"
      style="margin-top: 10px;"
      atom-action="GET /action/open-file"
    >
      Прикрепить файл...
    </button>

   <button 
      type="button"
      class="action-button"
      style="margin-top: 10px;"
      atom-action="POST /action/saveReceipt"
    >
      Сохранить чек в файл
    </button>
</div>